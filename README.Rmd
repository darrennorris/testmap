---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# testmap

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![pkgdown](https://github.com/darrennorris/testmap/workflows/pkgdown/badge.svg)](https://github.com/darrennorris/eprdados/actions)
[![R-CMD-check](https://github.com/darrennorris/testmap/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/darrennorris/testmap/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of testmap is to map future population changes of 
the Yellow-spotted river turtle (*Podocnemis unifilis*).

## Objectives
These maps are being used to

 - Provide an updated assesment of how threatened the species is.

 - Inform development of and implement improvements to the modelling process.

 
## Results
Summaries of the results including maps of the projected future changes 
can be found online.

 - 3 generation.    
 Predicted changes after 42 years: https://darrennorris.github.io/testmap/articles/Interactive-map.html

## Installation

You can download the data to check and visualise using R.
testmap cannot be submitted to CRAN as the data files are large and the package 
does not therefore pass "cran" checks.

So you need to install testmap like so:

``` r
install.packages("remotes")
remotes::install_github("darrennorris/testmap")
```

## Example

This is a basic example which shows a summary of 
where *Podocnemis unifilis* is Endangered in different countries.  
Another example with code to make a map is here: 
https://darrennorris.github.io/testmap/articles/testmap.html

```{r example, warning=FALSE, message=FALSE}
library(testmap)
library(dplyr)

## Summary by country.
points_bau_ffr |> 
  dplyr::mutate(flag_EN = if_else(fem_diff_t42 <= -0.5, 1, 0)) |>
  dplyr::group_by(COUNTRY) |> 
  dplyr::summarise(pop_start = sum(fem_t0), 
                   pop_end = sum(fem_t42), 
                   pop_change = round(((sum(fem_t42) - sum(fem_t0)) / sum(fem_t0)), 3),
                   change_lcl_95 = Hmisc::smean.cl.boot(fem_diff_t42)["Lower"], 
                   change_ucl_95 = Hmisc::smean.cl.boot(fem_diff_t42)["Upper"],
                   length_river = n(), 
                   length_endangered = sum((flag_EN))) |>
  dplyr::ungroup() |> 
  dplyr::mutate(proportion_endangered = round((length_endangered / length_river), 2)) |> 
  dplyr::mutate(threat_status = case_when(pop_change <= -0.8 ~ "Critically Endangered", 
                                   pop_change <= -0.5 ~ "Endangered", 
                                   pop_change <= -0.3 ~ "Vulnerable", 
                                   pop_change <= -0.2 ~ "Near Threatened"))
```


Package developed and built using the following guides:

 * Fan Wang: https://fanwangecon.github.io/PkgTestR/articles/ffv_pkgdown_github.html
and

 * Emil Hvitfeldt: https://emilhvitfeldt.com/post/2018-09-02-usethis-workflow-for-package-development/
and

 * Saskia O: https://www.marinedatascience.co/blog/2020/01/09/checklist-for-r-package-re-submissions-on-cran/
